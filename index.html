<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPLBanters 2025</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#f4f4f4">
    <link rel="icon" href="./icon.png">   
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!--      <script src="https://cdn.jsdelivr.net/npm/uuid@10.0.0/dist/index.min.js"></script> -->
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h1, h2, h3, h4 {
            text-align: center;
            color: #333;
        }
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            background: #ddd;
            cursor: pointer;
            margin: 5px;
            border-radius: 4px;
        }
        .tab.active {
            background: #007bff;
            color: #fff;
        }
        .tab.hidden {
            display: none;
        }
        .sub-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
        }
        .sub-tab {
            padding: 8px 16px;
            background: #e9ecef;
            cursor: pointer;
            margin: 5px;
            border-radius: 4px;
        }
        .sub-tab.active {
            background: #28a745;
            color: #fff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .sub-tab-content {
            display: none;
        }
        .sub-tab-content.active {
            display: block;
        }
        .user-container, .form-container, .predictions, .leaderboard, .results-container, .admin-container {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        input, select, button {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #28a745;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #218838;
        }
        .danger-button {
            background-color: #dc3545;
        }
        .danger-button:hover {
            background-color: #c82333;
        }
        .edit-button {
            background-color: #007bff;
            margin-right: 10px;
        }
        .edit-button:hover {
            background-color: #0056b3;
        }
        .drs-button {
            background-color: #ffc107;
            color: #333;
            width: auto;
            padding: 8px 16px;
            margin-top: 10px;
            display: inline-block;
        }
        .drs-button:hover {
            background-color: #e0a800;
        }
        .small-button {
            padding: 6px 12px;
            font-size: 12px;
            width: auto;
            display: inline-block;
        }
        .error {
            color: red;
            font-size: 14px;
            margin-bottom: 15px;
        }
        .success {
            color: green;
            font-size: 14px;
            margin-bottom: 15px;
        }
        .users-list, .predictions, .results-list, .matches-list, .winners-list {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .user-item, .prediction-item, .result-item, .match-item, .winner-item {
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .user-item:last-child, .prediction-item:last-child, .result-item:last-child, .match-item:last-child, .winner-item:last-child {
            border-bottom: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        canvas {
            margin: 20px 0;
            max-width: 100%;
        }
        .admin-section {
            margin-bottom: 30px;
        }
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        .match-prediction {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .radio-group {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }
        .radio-group label {
            font-weight: normal;
            margin-bottom: 0;
        }
        .timer {
            font-size: 14px;
            color: #555;
            margin-bottom: 10px;
        }
        .timer.expired {
            color: red;
        }
        .pie-charts-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .pie-chart-item {
            width: 200px;
            text-align: center;
        }
        .pie-chart-item h4 {
            margin-bottom: 10px;
        }
        @media (max-width: 600px) {
            .tabs, .sub-tabs {
                flex-direction: column;
                align-items: center;
            }
            .tab, .sub-tab {
                width: 100%;
                text-align: center;
                margin: 5px 0;
            }
            table {
                font-size: 14px;
            }
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
            canvas {
                max-width: 100%;
            }
            .pie-chart-item {
                width: 100%;
            }
        }
        .match-prediction {
    margin-bottom: 20px;
    padding: 10px;
    border-bottom: 1px solid #ccc;
}

.match-details {
    background-color: #f5f5f5;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
}

.make-prediction {
    margin-top: 10px;
}

.current-prediction {
    color: #d32f2f;
    font-weight: bold;
    margin-top: 10px;
}
#todaysMatches {
    margin: 15px 0;
    padding: 20px;
    background: linear-gradient(135deg, #6b48ff, #00ddeb); /* IPL gradient */
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    animation: fadeIn 0.5s ease-in-out;
}

#todaysMatches h3 {
    margin: 0 0 15px 0;
    font-size: 1.8em;
    font-weight: 700;
    color: #fff;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    text-align: center;
}

#todaysMatches .matches-list {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center;
}

#todaysMatches .match-card {
    background: #fff;
    border-radius: 10px;
    padding: 15px;
    width: 320px; /* Slightly wider for logos */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

#todaysMatches .match-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
}

#todaysMatches .match-card .teams {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
}

#todaysMatches .match-card .teams .team {
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 100px;
    text-align: center;
}

#todaysMatches .match-card .teams .team-logo {
    width: 50px;
    height: 50px;
    object-fit: contain;
    margin-bottom: 5px;
}

#todaysMatches .match-card .teams .team-name {
    font-size: 0.9em;
    font-weight: 500;
    color: #333;
}

#todaysMatches .match-card .teams .vs {
    color: #ff4081; /* Pink for "vs" */
    font-weight: bold;
    font-size: 1.2em;
}

#todaysMatches .match-card .details {
    font-size: 0.9em;
    color: #555;
    text-align: center;
}

#todaysMatches .match-card .time {
    color: #1976d2; /* Blue for time */
    font-weight: 500;
}

#todaysMatches .match-card .venue {
    color: #388e3c; /* Green for venue */
}

#todaysMatches p.no-matches {
    color: #fff;
    font-size: 1.1em;
    text-align: center;
    opacity: 0.9;
}

/* Fade-in animation */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive design */
@media (max-width: 600px) {
    #todaysMatches {
        padding: 15px;
    }

    #todaysMatches .match-card {
        width: 100%;
    }

    #todaysMatches .match-card .teams .team-logo {
        width: 40px;
        height: 40px;
    }

    #todaysMatches .match-card .teams .team-name {
        font-size: 0.8em;
    }
}

/* Modal styles for editing matches */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}
.modal-content {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    animation: fadeIn 0.3s ease-in-out;
}
.modal-content .close {
    float: right;
    font-size: 1.5em;
    cursor: pointer;
    color: #333;
}
.modal-content h3 {
    margin: 0 0 15px 0;
    color: #1a237e;
}
#editMatchForm {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
#editMatchForm label {
    font-weight: 500;
    color: #333;
}
#editMatchForm input, #editMatchForm select {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
    font-size: 1em;
}
#editMatchForm button {
    padding: 10px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 500;
}
#editMatchForm button[type="submit"] {
    background: #388e3c;
    color: #fff;
}
#editMatchForm button[type="submit"]:hover {
    background: #2e7d32;
}
#editMatchForm #cancelEditMatch {
    background: #d32f2f;
    color: #fff;
}
#editMatchForm #cancelEditMatch:hover {
    background: #b71c1c;
}

     #predictToken {
    text-transform: uppercase;
}
#adminUserToken {
    text-transform: uppercase;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 5px;
    width: 100%;
}
#generateToken {
    background: #ffc107;
    color: #333;
    width: auto;
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
#generateToken:hover {
    background: #e0a800;
}
@media (max-width: 600px) {
    #adminUserToken, #generateToken {
        width: 100%;
    }
    #adminUserToken + #generateToken {
        margin-top: 10px;
    }
}
    #predictToken {
    text-transform: uppercase;
}
#adminUserToken {
    background: #f8f9fa;
}
#generateToken {
    background: #ffc107;
    color: #333;
    width: auto;
    padding: 8px 16px;
}
#generateToken:hover {
    background: #e0a800;
}
        
    </style>
</head>
<body>
    <h1>IPLBanters 2025</h1>

    <div class="tabs">
        <div class="tab active" data-tab="predict">Predict</div>
        <div class="tab" data-tab="predictions">Predictions</div>
        <div class="tab" data-tab="leaderboard">Leaderboard</div>
        <div class="tab" data-tab="admin" id="adminTab">Admin</div>
    </div>

<div class="tab-content active" id="predict">
    <div id="todaysMatches"></div>
  <div class="form-container">
    <h2>Make Predictions</h2>
    <label for="predictUserId">Select User:</label>
    <select id="predictUserId" required>
        <option value="">Select a user</option>
    </select>
    <label for="predictToken">User Token:</label>
    <input type="text" id="predictToken" placeholder="Enter your token (e.g., X7B9P4)" required>
    <div id="predictError" class="error"></div>
    <div id="predictSuccess" class="success"></div>
    <div id="predictMatches"></div>
    <button id="submitPredictions" type="button">Submit Predictions</button>
</div>
</div>

    <div class="tab-content" id="predictions">
        <div class="predictions">
            <h2>Live Predictions</h2>
            <div id="predictionsList"></div>
            <h3>Live Predictions by Team</h3>
            <canvas id="predictionsPieChart"></canvas>
        </div>
    </div>

    <div class="tab-content" id="leaderboard">
        <div class="leaderboard">
            <h2>Leaderboard</h2>
            <div id="leaderboardList"></div>
            <h3>User Predictions and Wins</h3>
            <canvas id="userBarChart"></canvas>
            <h3>User Win/Loss Distribution</h3>
            <div id="userPieCharts" class="pie-charts-container"></div>
        </div>
    </div>

    <div class="tab-content" id="admin">
        <div class="admin-container">
            <h2>Admin Dashboard</h2>
            <button id="logoutAdmin" class="danger-button small-button">Logout</button>
            <div class="sub-tabs">
                <div class="sub-tab active" data-sub-tab="admin-users">Users</div>
                <div class="sub-tab" data-sub-tab="admin-schedule">Schedule</div>
                <div class="sub-tab" data-sub-tab="admin-results">Results</div>
            </div>
            <div class="sub-tab-content active" id="admin-users">
                <div class="user-container">
                    <h3 id="userFormTitle">Add User</h3>
                   <form id="adminUserForm">
    <label for="adminNewUserName">User Name:</label>
    <input type="text" id="adminNewUserName" placeholder="Enter user name" required>
    <label for="adminUserToken">User Token:</label>
    <div style="display: flex; gap: 10px;">
        <input type="text" id="adminUserToken" placeholder="Enter token (e.g., X7B9P4)" maxlength="6">
        <button type="button" id="generateToken">Generate Token</button>
    </div>
    <label><input type="checkbox" id="isAdmin"> Admin User</label>
    <div id="adminUserError" class="error"></div>
    <div id="adminUserSuccess" class="success"></div>
    <button type="submit">Add User</button>
</form>
                    <div class="users-list">
                        <h3>Registered Users</h3>
                        <div id="userList"></div>
                    </div>
                </div>
            </div>
            <div class="sub-tab-content" id="admin-schedule">
                <div class="admin-section">
                    <h3>Import Schedule (CSV)</h3>
                    <p>Format: date,team1,team2,time,venue (e.g., 2025-04-13,RR,RCB,15:30,Sawai Mansingh Stadium)</p>
                    <input type="file" id="matchCsv" accept=".csv">
                    <div id="csvError" class="error"></div>
                    <div id="csvSuccess" class="success"></div>
                </div>
                <div class="admin-section">
                    <h3>Add Match Manually</h3>
                    <form id="matchForm">
                        <label for="matchDateAdmin">Match Date:</label>
                        <input type="date" id="matchDateAdmin" required>
                        <label for="matchTimeAdmin">Match Time (IST):</label>
                        <select id="matchTimeAdmin" required>
                            <option value="">Select time</option>
                            <option value="15:30">3:30 PM IST</option>
                            <option value="19:30">7:30 PM IST</option>
                        </select>
                        <label for="matchTeam1">Team 1:</label>
                        <select id="matchTeam1" required>
                            <option value="">Select Team 1</option>
                            <option value="CSK">CSK</option>
                            <option value="MI">MI</option>
                            <option value="RCB">RCB</option>
                            <option value="KKR">KKR</option>
                            <option value="SRH">SRH</option>
                            <option value="RR">RR</option>
                            <option value="GT">GT</option>
                            <option value="DC">DC</option>
                            <option value="LSG">LSG</option>
                            <option value="PBKS">PBKS</option>
                        </select>
                        <label for="matchTeam2">Team 2:</label>
                        <select id="matchTeam2" required>
                            <option value="">Select Team 2</option>
                            <option value="CSK">CSK</option>
                            <option value="MI">MI</option>
                            <option value="RCB">RCB</option>
                            <option value="KKR">KKR</option>
                            <option value="SRH">SRH</option>
                            <option value="RR">RR</option>
                            <option value="GT">GT</option>
                            <option value="DC">DC</option>
                            <option value="LSG">LSG</option>
                            <option value="PBKS">PBKS</option>
                        </select>
                        <label for="matchVenue">Venue:</label>
                        <input type="text" id="matchVenue" placeholder="Enter venue (e.g., Wankhede Stadium)" required>
                        <div id="matchError" class="error"></div>
                        <div id="matchSuccess" class="success"></div>
                        <button type="submit">Add Match</button>
                    </form>
                    <div class="matches-list">
                        <h3>IPL 2025 Schedule</h3>
                        <div id="matchList"></div>
                    </div>
                </div>
            </div>
            <div class="sub-tab-content" id="admin-results">
                <div class="results-container">
                    <h3>Add Match Result</h3>
                    <form id="resultForm">
                        <label for="matchSelect">Select Match:</label>
                        <select id="matchSelect" required>
                            <option value="">Select a match</option>
                        </select>
                        <label for="resultDate">Match Date:</label>
                        <input type="date" id="resultDate" readonly>
                        <label for="team1">Team 1:</label>
                        <input type="text" id="team1" readonly>
                        <label for="team2">Team 2:</label>
                        <input type="text" id="team2" readonly>
                        <label>Winner:</label>
                        <div class="radio-group" id="winnerRadio">
                            <!-- Populated dynamically -->
                        </div>
                        <div id="resultError" class="error"></div>
                        <button type="submit">Add Result</button>
                    </form>
                    <div class="results-list">
                        <h3>Match Results</h3>
                        <div id="resultList"></div>
                    </div>
                    <div class="winners-list">
                        <h3>Winning Teams</h3>
                        <div id="winnersList"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
      // Initialize Supabase client
const supabase = window.supabase.createClient('https://cinrdyzazzxchoqffmrk.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpbnJkeXphenp4Y2hvcWZmbXJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ2MDI0MTMsImV4cCI6MjA2MDE3ODQxM30.5bEroboJkXGr9VTeuuVmMn6yz_SNZc7ZGCN0HmAilIg');

// Generate unique ID
// function generateId() {
//     return uuid.v4();
// }
        function generateId() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        const r = (Math.random() * 16) | 0;
        const v = c === 'x' ? r : (r & 0x3) | 0x8;
        return v.toString(16);
    });
}

        // Valid teams
        const validTeams = ["CSK", "MI", "RCB", "KKR", "SRH", "RR", "GT", "DC", "LSG", "PBKS"];
        const ADMIN_PASSWORD = "Dhoni123";

        // Initialize data
        let users = [];
        let predictions = [];
        let results = [];
        let iplSchedule = [];
        let drsUsed = [];

        // generate user tokens
function generateToken() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let token = '';
    for (let i = 0; i < 6; i++) {
        token += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return token;
}

document.getElementById('generateToken').addEventListener('click', () => {
    const tokenInput = document.getElementById('adminUserToken');
    if (tokenInput) tokenInput.value = generateToken();
});
        // Fetch data from Supabase
     async function fetchData() {
    try {
        const { data: usersData, error: usersError } = await supabase.from('users').select('id, name, is_admin, token');
        if (usersError) throw new Error(`Failed to fetch users: ${usersError.message}`);
        users = usersData || [];

        const { data: predictionsData, error: predictionsError } = await supabase.from('predictions').select('*');
        if (predictionsError) throw new Error(`Failed to fetch predictions: ${predictionsError.message}`);
        predictions = predictionsData || [];

        const { data: resultsData, error: resultsError } = await supabase.from('results').select('*');
        if (resultsError) throw new Error(`Failed to fetch results: ${resultsError.message}`);
        results = resultsData || [];

        const { data: scheduleData, error: scheduleError } = await supabase.from('ipl_schedule').select('*');
        if (scheduleError) throw new Error(`Failed to fetch schedule: ${scheduleError.message}`);
        iplSchedule = scheduleData || [];

        const { data: drsData, error: drsError } = await supabase.from('drs_used').select('*');
        if (drsError) throw new Error(`Failed to fetch DRS data: ${drsError.message}`);
        drsUsed = drsData || [];

        console.log('Fetched data:', { users, predictions, results, iplSchedule, drsUsed });
    } catch (error) {
        console.error('Error fetching data:', error);
        document.getElementById('predictError').textContent = 'Failed to load data. Please try again.';
    }
}

        // Save data to Supabase
    async function saveUsers() {
    try {
        const { error } = await supabase.from('users').upsert(users, { onConflict: 'id' });
        if (error) throw error;
        console.log('Saved users:', users);
    } catch (error) {
        console.error('Failed to save users:', error);
        document.getElementById('adminUserError').textContent = 'Failed to save users.';
    }
}

        async function savePredictions() {
            try {
                const { error } = await supabase.from('predictions').upsert(predictions, { onConflict: ['user_id', 'match_id'] });
                if (error) throw error;
                console.log('Saved predictions:', predictions);
            } catch (error) {
                console.error('Failed to save predictions:', error);
            }
        }

        async function saveResults() {
            try {
                const { error } = await supabase.from('results').upsert(results, { onConflict: 'id' });
                if (error) throw error;
                console.log('Saved results:', results);
            } catch (error) {
                console.error('Failed to save results:', error);
            }
        }

        async function saveIplSchedule() {
            try {
                const { error } = await supabase.from('ipl_schedule').upsert(iplSchedule, { onConflict: 'id' });
                if (error) throw error;
                console.log('Saved schedule:', iplSchedule);
            } catch (error) {
                console.error('Failed to save schedule:', error);
            }
        }

        async function saveDrsUsed() {
            try {
                const { error } = await supabase.from('drs_used').upsert(drsUsed, { onConflict: ['user_id', 'match_id'] });
                if (error) throw error;
                console.log('Saved DRS used:', drsUsed);
            } catch (error) {
                console.error('Failed to save DRS used:', error);
            }
        }

        // Admin login
 function checkAdminAccess(tabId) {
    try {
        if (localStorage.getItem('adminLoggedIn') === 'true') {
            switchTab(tabId);
            return;
        }
        const password = prompt('Enter admin password:');
        if (password === ADMIN_PASSWORD) {
            localStorage.setItem('adminLoggedIn', 'true');
            switchTab(tabId);
        } else {
            alert('Incorrect password');
            switchTab('predict');
        }
    } catch (error) {
        console.error('Admin access error:', error);
        switchTab('predict');
    }
}

        // Switch main tab
       function switchTab(tabId) {
    try {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        const tab = document.querySelector(`.tab[data-tab="${tabId}"]`);
        const content = document.getElementById(tabId);
        if (tab && content) {
            tab.classList.add('active');
            content.classList.add('active');
            console.log(`Switched to tab: ${tabId}`);
            if (tabId === 'predict') displayPredict();
            else if (tabId === 'predictions') displayPredictions();
            else if (tabId === 'leaderboard') displayLeaderboard();
            else if (tabId === 'admin') switchSubTab('admin-users');
        } else {
            console.error(`Tab or content not found for ID: ${tabId}`);
            switchTab('predict'); // Fallback to Predict tab
        }
    } catch (error) {
        console.error('Switch tab error:', error);
    }
}

        // Switch admin sub-tab
    function switchSubTab(subTabId) {
    try {
        document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.sub-tab-content').forEach(c => c.classList.remove('active'));
        const subTab = document.querySelector(`.sub-tab[data-sub-tab="${subTabId}"]`);
        const subContent = document.getElementById(subTabId);
        if (subTab && subContent) {
            subTab.classList.add('active');
            subContent.classList.add('active');
            console.log(`Switched to sub-tab: ${subTabId}`);
            if (subTabId === 'admin-users') displayAdminUsers();
            else if (subTabId === 'admin-schedule') displayAdminSchedule();
            else if (subTabId === 'admin-results') displayAdminResults();
        } else {
            console.error(`Sub-tab or content not found for ID: ${subTabId}`);
            switchSubTab('admin-users'); // Fallback to Users sub-tab
        }
    } catch (error) {
        console.error('Switch sub-tab error:', error);
    }
}

        // Tab navigation
       function initializeTabs() {
    try {
        const tabs = document.querySelectorAll('.tab');
        const subTabs = document.querySelectorAll('.sub-tab');
        const isAdminLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';

        const adminTab = document.getElementById('adminTab');
        if (adminTab) adminTab.classList.remove('hidden');
        switchTab(isAdminLoggedIn ? 'admin' : 'predict');

        tabs.forEach(tab => {
            tab.removeEventListener('click', handleTabClick); // Prevent duplicates
            tab.addEventListener('click', handleTabClick);
        });

        subTabs.forEach(subTab => {
            subTab.removeEventListener('click', handleSubTabClick);
            subTab.addEventListener('click', handleSubTabClick);
        });

        function handleTabClick(e) {
            const tabId = e.currentTarget.dataset.tab;
            console.log(`Tab clicked: ${tabId}`);
            if (tabId === 'admin' && localStorage.getItem('adminLoggedIn') !== 'true') {
                checkAdminAccess(tabId);
                return;
            }
            switchTab(tabId);
        }

       function handleSubTabClick(e) {
            const subTabId = e.currentTarget.dataset.subTab;
            console.log(`Sub-tab clicked: ${subTabId}`);
            switchSubTab(subTabId);
        }
    } catch (error) {
        console.error('Initialize tabs error:', error);
    }
}

        // Admin logout
        document.getElementById('logoutAdmin').addEventListener('click', () => {
            console.log('Admin logout clicked');
            localStorage.removeItem('adminLoggedIn');
            switchTab('predict');
        });

        // CSV import
        async function handleCsvImport(e) {
            const error = document.getElementById('csvError');
            const success = document.getElementById('csvSuccess');
            error.textContent = '';
            success.textContent = '';

            if (!e.target.files[0]) {
                error.textContent = 'No file selected.';
                return;
            }

            Papa.parse(e.target.files[0], {
                header: true,
                skipEmptyLines: true,
                complete: async results => {
                    let added = 0;
                    const newMatches = [];
                    for (const row of results.data) {
                        if (!row.date || !row.team1 || !row.team2 || !row.time || !row.venue) {
                            console.warn('Skipping invalid row:', row);
                            continue;
                        }
                        if (!validTeams.includes(row.team1) || !validTeams.includes(row.team2)) {
                            console.warn('Invalid teams:', row.team1, row.team2);
                            continue;
                        }
                        if (row.team1 === row.team2) {
                            console.warn('Same teams:', row.team1);
                            continue;
                        }
                        if (!['15:30', '19:30'].includes(row.time)) {
                            console.warn('Invalid time:', row.time);
                            continue;
                        }
                        if (iplSchedule.some(m => m.date === row.date && m.team1 === row.team1 && m.team2 === row.team2)) {
                            console.warn('Duplicate match:', row.date, row.team1, row.team2);
                            continue;
                        }
                        if (!/^\d{4}-\d{2}-\d{2}$/.test(row.date)) {
                            console.warn('Invalid date format:', row.date);
                            continue;
                        }

                        const istDateTime = new Date(`${row.date}T${row.time}:00+05:30`);
                        if (isNaN(istDateTime.getTime())) {
                            console.warn('Invalid date/time:', row.date, row.time);
                            continue;
                        }
                        istDateTime.setMinutes(istDateTime.getMinutes() - 30);
                        const deadline = istDateTime.toISOString();

                        newMatches.push({
                            id: generateId(),
                            date: row.date,
                            team1: row.team1,
                            team2: row.team2,
                            time: row.time,
                            deadline,
                            venue: row.venue.trim()
                        });
                        added++;
                    }

                    if (added === 0) {
                        error.textContent = 'No valid matches added. Check CSV format.';
                        return;
                    }

                    iplSchedule.push(...newMatches);
                    await saveIplSchedule();
                    success.textContent = `Added ${added} matches!`;
                    console.log('Imported matches:', newMatches);
                    displayAdminSchedule();
                    displayPredict();
                    displayAdminResults();
                    e.target.value = '';
                },
                error: err => {
                    error.textContent = 'Failed to parse CSV: ' + err.message;
                    console.error('CSV parse error:', err);
                }
            });
        }

        // Display admin users
   async function displayAdminUsers() {
    try {
        const userList = document.getElementById('userList');
        if (!userList) throw new Error('userList element not found');
        userList.innerHTML = users.map(user => `
            <div class="user-item">
                <span>${user.name}${user.is_admin ? ' (Admin)' : ''}${user.token ? `, Token: ${user.token}` : ''}</span>
                <div class="action-buttons">
                    <button class="edit-button edit-user small-button" data-id="${user.id}">Edit</button>
                    <button class="danger-button delete-user small-button" data-id="${user.id}" ${predictions.some(p => p.user_id === user.id) ? 'disabled' : ''}>Delete</button>
                </div>
            </div>
        `).join('');

        // Remove existing listeners to prevent duplicates
        document.querySelectorAll('.edit-user').forEach(btn => {
            btn.removeEventListener('click', handleEditUser);
            btn.addEventListener('click', handleEditUser);
        });

        document.querySelectorAll('.delete-user').forEach(btn => {
            btn.removeEventListener('click', handleDeleteUser);
            btn.addEventListener('click', handleDeleteUser);
        });

        function handleEditUser() {
            const userId = this.dataset.id;
            const user = users.find(u => u.id === userId);
            if (user) {
                document.getElementById('userFormTitle').textContent = 'Edit User';
                document.getElementById('adminNewUserName').value = user.name;
                document.getElementById('adminUserToken').value = user.token || '';
                document.getElementById('isAdmin').checked = user.is_admin;
                document.getElementById('adminUserForm').dataset.id = userId;
                document.getElementById('adminUserForm').querySelector('button').textContent = 'Update User';
            }
        }

        function handleDeleteUser() {
            const userId = this.dataset.id;
            if (confirm(`Delete user "${users.find(u => u.id === userId).name}"?`)) {
                users = users.filter(u => u.id !== userId);
                predictions = predictions.filter(p => p.user_id !== userId);
                drsUsed = drsUsed.filter(d => d.user_id === userId);
                Promise.all([
                    supabase.from('users').delete().eq('id', userId),
                    supabase.from('predictions').delete().eq('user_id', userId),
                    supabase.from('drs_used').delete().eq('user_id', userId)
                ]).then(() => {
                    displayAdminUsers();
                    displayLeaderboard();
                    populateUserDropdowns();
                }).catch(err => {
                    console.error('Delete user error:', err);
                    document.getElementById('adminUserError').textContent = 'Failed to delete user.';
                });
            }
        }

        populateUserDropdowns();
    } catch (error) {
        console.error('Display admin users error:', error);
        document.getElementById('adminUserError').textContent = 'Failed to load users.';
    }
}
        
        // ----- Add Token Generation Button Handler
        document.getElementById('generateToken').addEventListener('click', () => {
    document.getElementById('adminUserToken').value = generateToken();
});
        
        // Display admin schedule
      async function displayAdminSchedule() {
    const matchList = document.getElementById('matchList');
    matchList.innerHTML = iplSchedule.map(m => `
        <div class="match-item">
            <span>${m.date}: ${m.team1} vs ${m.team2}, ${m.time} IST, ${m.venue ? m.venue : 'No venue'}</span>
            <div class="action-buttons">
                <button class="edit-button edit-match small-button" data-id="${m.id}">Edit</button>
                <button class="danger-button delete-match small-button" data-id="${m.id}">Delete</button>
            </div>
        </div>
    `).join('');

    document.querySelectorAll('.edit-match').forEach(btn => {
        btn.addEventListener('click', () => {
            const matchId = btn.dataset.id;
            const match = iplSchedule.find(m => m.id === matchId);
            if (match) {
                document.getElementById('editMatchId').value = match.id;
                document.getElementById('editMatchDate').value = match.date;
                document.getElementById('editMatchTime').value = match.time;
                document.getElementById('editMatchTeam1').value = match.team1;
                document.getElementById('editMatchTeam2').value = match.team2;
                document.getElementById('editMatchVenue').value = match.venue || '';
                document.getElementById('editMatchModal').style.display = 'flex';
            }
        });
    });

    document.querySelectorAll('.delete-match').forEach(btn => {
        btn.addEventListener('click', async () => {
            if (confirm('Delete this match?')) {
                const matchId = btn.dataset.id;
                iplSchedule = iplSchedule.filter(m => m.id !== matchId);
                predictions = predictions.filter(p => p.match_id !== matchId);
                drsUsed = drsUsed.filter(d => d.match_id !== matchId);
                results = results.filter(r => r.match_id !== matchId);
                await Promise.all([
                    supabase.from('ipl_schedule').delete().eq('id', matchId),
                    supabase.from('predictions').delete().eq('match_id', matchId),
                    supabase.from('drs_used').delete().eq('match_id', matchId),
                    supabase.from('results').delete().eq('match_id', matchId)
                ]);
                displayAdminSchedule();
                displayPredict();
                displayAdminResults();
            }
        });
    });
}

        // Populate match dropdown and update form
        function populateMatchDropdown(editingMatchId = null) {
            const matchSelect = document.getElementById('matchSelect');
            const existingResultMatchIds = results.map(r => r.match_id);
            const availableMatches = iplSchedule
                .filter(m => !existingResultMatchIds.includes(m.id) || m.id === editingMatchId)
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            matchSelect.innerHTML = '<option value="">Select a match</option>' +
                availableMatches.map(m => `
                    <option value="${m.id}" ${m.id === editingMatchId ? 'selected' : ''}>${m.date}: ${m.team1} vs ${m.team2}</option>
                `).join('');

            if (editingMatchId) {
                matchSelect.dispatchEvent(new Event('change'));
            }

            matchSelect.addEventListener('change', () => {
                const matchId = matchSelect.value;
                const match = iplSchedule.find(m => m.id === matchId);
                const resultDate = document.getElementById('resultDate');
                const team1 = document.getElementById('team1');
                const team2 = document.getElementById('team2');
                const winnerRadio = document.getElementById('winnerRadio');

                if (match) {
                    resultDate.value = match.date;
                    team1.value = match.team1;
                    team2.value = match.team2;
                    winnerRadio.innerHTML = `
                        <label><input type="radio" name="winner" value="${match.team1}" required> ${match.team1}</label>
                        <label><input type="radio" name="winner" value="${match.team2}"> ${match.team2}</label>
                    `;
                } else {
                    resultDate.value = '';
                    team1.value = '';
                    team2.value = '';
                    winnerRadio.innerHTML = '';
                }
            }, { once: true });
        }

        // Display admin results
        async function displayAdminResults() {
            populateMatchDropdown();

            const resultList = document.getElementById('resultList');
            resultList.innerHTML = results.map(r => {
                const match = iplSchedule.find(m => m.id === r.match_id);
                return match ? `
                    <div class="result-item">
                        <span>${match.date}: ${match.team1} vs ${match.team2}, Winner: ${r.winner}</span>
                        <div class="action-buttons">
                            <button class="edit-button edit-result small-button" data-id="${r.id}" data-match-id="${r.match_id}">Edit</button>
                            <button class="danger-button delete-result small-button" data-id="${r.id}">Delete</button>
                        </div>
                    </div>
                ` : '';
            }).join('');

            document.querySelectorAll('.edit-result').forEach(btn => {
                btn.addEventListener('click', () => {
                    const resultId = btn.dataset.id;
                    const matchId = btn.dataset.match_id;
                    const result = results.find(r => r.id === resultId);
                    const match = iplSchedule.find(m => m.id === matchId);
                    if (match && result) {
                        populateMatchDropdown(matchId);
                        document.getElementById('resultDate').value = match.date;
                        document.getElementById('team1').value = match.team1;
                        document.getElementById('team2').value = match.team2;
                        document.getElementById('winnerRadio').innerHTML = `
                            <label><input type="radio" name="winner" value="${match.team1}" ${result.winner === match.team1 ? 'checked' : ''} required> ${match.team1}</label>
                            <label><input type="radio" name="winner" value="${match.team2}" ${result.winner === match.team2 ? 'checked' : ''}> ${match.team2}</label>
                        `;
                        document.getElementById('resultForm').dataset.id = resultId;
                    }
                });
            });

            document.querySelectorAll('.delete-result').forEach(btn => {
                btn.addEventListener('click', async () => {
                    if (confirm('Delete this result?')) {
                        const resultId = btn.dataset.id;
                        results = results.filter(r => r.id !== resultId);
                        await supabase.from('results').delete().eq('id', resultId);
                        displayAdminResults();
                        displayLeaderboard();
                    }
                });
            });

            const winnersList = document.getElementById('winnersList');
            const teamWins = {};
            results.forEach(r => {
                const match = iplSchedule.find(m => m.id === r.match_id);
                if (match) {
                    teamWins[r.winner] = teamWins[r.winner] || { count: 0, matches: [] };
                    teamWins[r.winner].count++;
                    teamWins[r.winner].matches.push(`${match.date}: ${match.team1} vs ${match.team2}`);
                }
            });

            winnersList.innerHTML = Object.keys(teamWins).length > 0 ? `
                <table>
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>Wins</th>
                            <th>Matches Won</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${Object.entries(teamWins)
                            .sort((a, b) => b[1].count - a[1].count)
                            .map(([team, data]) => `
                                <tr>
                                    <td>${team}</td>
                                    <td>${data.count}</td>
                                    <td>${data.matches.join('<br>')}</td>
                                </tr>
                            `).join('')}
                    </tbody>
                </table>
            ` : '<p>No winning teams yet.</p>';
        }

        // Populate user dropdown
       function populateUserDropdowns() {
    const userSelect = document.getElementById('predictUserId');
    if (!users || users.length === 0) {
        userSelect.innerHTML = '<option value="">No users available</option>';
        console.warn('No users to populate dropdown');
    } else {
        userSelect.innerHTML = '<option value="">Select a user</option>' +
            users.map(user => `<option value="${user.id}">${user.name}</option>`).join('');
        console.log('Populated dropdown with users:', users);
    }
    userSelect.removeEventListener('change', handleUserChange);
    userSelect.addEventListener('change', handleUserChange);

    function handleUserChange() {
        console.log('User changed to:', userSelect.value);
        displayPredict();
    }
}

        // Format timer
        function formatTimer(deadline, matchId) {
            const now = new Date().getTime();
            if (!deadline || now >= deadline) {
                return `<span class="timer expired" id="timer-${matchId}">Prediction closed</span>`;
            }

            const diff = deadline - now;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            return `<span class="timer" id="timer-${matchId}">Time left: ${hours}h ${minutes}m ${seconds}s</span>`;
        }

        // Update timers
        function updateTimers() {
            const today = new Date().toISOString().split('T')[0];
            const todayMatches = iplSchedule.filter(m => m.date === today);
            todayMatches.forEach(match => {
                const timerElement = document.getElementById(`timer-${match.id}`);
                if (timerElement) {
                    const deadline = match.deadline ? new Date(match.deadline).getTime() : null;
                    timerElement.outerHTML = formatTimer(deadline, match.id);
                }
            });
        }

        // Display predict tab displayPredict
     // Team logo URLs (replace with actual URLs or Supabase Storage paths)
const teamLogos = {
    'CSK': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/CSK.png?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9DU0sucG5nIiwiaWF0IjoxNzQ0NjQ2NzA0LCJleHAiOjIwNjAwMDY3MDR9._d_xz1y1BgjHITNpNefq2kRxFBDyo46wmzKcjCyEjYk',
    'MI': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/MI.png?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9NSS5wbmciLCJpYXQiOjE3NDQ2NDY4NDUsImV4cCI6MjA2MDAwNjg0NX0.I4ASdZxNFWJ5NXGStiJCkZEiKPDIj_DCh_n-CJ-BEW0',
    'RCB': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/RCB.jpg?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9SQ0IuanBnIiwiaWF0IjoxNzQ0NjQ2ODg3LCJleHAiOjIwNjAwMDY4ODd9.9dBLWiGPHUXsT__K8TXpRgbJwu2m5pB1L4-22nAzL_E',
    'KKR': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/KKR.png?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9LS1IucG5nIiwiaWF0IjoxNzQ0NjQ2Nzk1LCJleHAiOjIwNjAwMDY3OTV9.oGW5RuvYyvUrdjOBp6pcr8w2dg9Khn8gBs8d-BKJ-lM',
    'DC': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/DC.png?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9EQy5wbmciLCJpYXQiOjE3NDQ2NDY3NDcsImV4cCI6MjA2MDAwNjc0N30.ACalALyTJsR8tRc3qbb7FZR3qr4zDqDQjG3fzSxGrMk',
    'PBKS': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/PKBS.jpg?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9QS0JTLmpwZyIsImlhdCI6MTc0NDY0Njg2NCwiZXhwIjoyMDYwMDA2ODY0fQ.y-wwbzRlfc-X7JC0PbJ7leJB5pBSC_8679hCeipfZic',
    'RR': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/RR.jpg?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9SUi5qcGciLCJpYXQiOjE3NDQ2NDY5MTAsImV4cCI6MjA2MDAwNjkxMH0.rWljRVtmIbzLyhKvCcC_WXdUQRhh-sogSfgB_YZmYX8',
    'SRH': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/SRH.jpg?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9TUkguanBnIiwiaWF0IjoxNzQ0NjQ2OTMzLCJleHAiOjIwNjAwMDY5MzN9.P0162GL7xK8esIgar3tukvsIZTpYj1ujUTvxgy-x4eg',
    'GT': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/GT.jpg?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9HVC5qcGciLCJpYXQiOjE3NDQ2NDY3NzUsImV4cCI6MjA2MDAwNjc3NX0.IJ_QfwucdpblgDIwQ5YwLBDamMdL0K_-FtofAFaDxQ4',
    'LSG': 'https://cinrdyzazzxchoqffmrk.supabase.co/storage/v1/object/sign/teams/LSG.jpg?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5X2IyZWY4MWFhLWNjYTItNDIxZi05ZGIwLTlkN2RhY2U3NTIyNyJ9.eyJ1cmwiOiJ0ZWFtcy9MU0cuanBnIiwiaWF0IjoxNzQ0NjQ2ODE4LCJleHAiOjIwNjAwMDY4MTh9.YnOSC8_6f0nN5BjL5p3s0eT_l1BTFbFnoTVMLj_HrCI'
};

function displayPredict() {
    try {
        const matchesContainer = document.getElementById('predictMatches');
        const todaysMatchesContainer = document.getElementById('todaysMatches');
        const userId = document.getElementById('predictUserId')?.value || '';
        const token = document.getElementById('predictToken')?.value.trim().toUpperCase() || '';
        const today = new Date().toLocaleDateString('en-CA');
        const todayMatches = iplSchedule.filter(m => m.date === today);

        if (!matchesContainer || !todaysMatchesContainer) {
            console.error('Predict containers not found');
            return;
        }

        if (todayMatches.length === 0) {
            todaysMatchesContainer.innerHTML = '<p class="no-matches">No matches scheduled for today.</p>';
            matchesContainer.innerHTML = '<p>No matches scheduled for today.</p>';
            document.getElementById('submitPredictions').style.display = 'none';
            clearInterval(window.timerInterval);
            return;
        }

        todaysMatchesContainer.innerHTML = `
            <h3>Today's Matches</h3>
            <div class="matches-list">
                ${todayMatches.map(match => `
                    <div class="match-card">
                        <div class="teams">
                            <div class="team">
                                ${teamLogos[match.team1] ? `<img src="${teamLogos[match.team1]}" alt="${match.team1}" class="team-logo" onerror="this.style.display='none';this.nextSibling.style.display='block';"><span class="team-name" style="display: none;">${match.team1}</span>` : `<span class="team-name">${match.team1}</span>`}
                            </div>
                            <span class="vs">vs</span>
                            <div class="team">
                                ${teamLogos[match.team2] ? `<img src="${teamLogos[match.team2]}" alt="${match.team2}" class="team-logo" onerror="this.style.display='none';this.nextSibling.style.display='block';"><span class="team-name" style="display: none;">${match.team2}</span>` : `<span class="team-name">${match.team2}</span>`}
                            </div>
                        </div>
                        <div class="details">
                            <span class="time">${match.time} IST</span>
                            ${match.venue ? `<span class="venue">, ${match.venue}</span>` : ''}
                        </div>
                    </div>
                `).join('')}
            </div>
        `;

        if (!userId || !token) {
            matchesContainer.innerHTML = '<p>Please select a user and enter a valid token.</p>';
            document.getElementById('submitPredictions').style.display = 'none';
            clearInterval(window.timerInterval);
            return;
        }

        const user = users.find(u => u.id === userId && u.token === token);
        if (!user) {
            matchesContainer.innerHTML = '<p>Invalid token for selected user.</p>';
            document.getElementById('submitPredictions').style.display = 'none';
            clearInterval(window.timerInterval);
            return;
        }

        document.getElementById('submitPredictions').style.display = 'block';
        matchesContainer.innerHTML = todayMatches.map(match => {
            const hasPredicted = predictions.some(p => p.user_id === userId && p.match_id === match.id);
            const drsWasUsed = drsUsed.some(d => d.user_id === userId && d.match_id === match.id);
            const currentPrediction = hasPredicted ? predictions.find(p => p.user_id === userId && p.match_id === match.id) : null;
            const deadline = match.deadline ? new Date(match.deadline).getTime() : null;
            const isExpired = !deadline || new Date().getTime() >= deadline;
            const localDeadline = match.deadline ? new Date(match.deadline).toLocaleString('en-US', { timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone, dateStyle: 'short', timeStyle: 'short' }) : 'No deadline';

            return `
                <div class="match-prediction">
                    <div class="match-details">
                        <h4>${match.date}: ${match.team1} vs ${match.team2} (${match.time} IST)${match.venue ? `, ${match.venue}` : ''}</h4>
                        <p>Prediction deadline: ${localDeadline}</p>
                        ${formatTimer(deadline, match.id)}
                    </div>
                    ${isExpired ? `<p>Prediction closed</p>` : `
                        <div class="make-prediction">
                            <h5>Make Prediction</h5>
                            <div class="radio-group">
                                <label><input type="radio" name="match-${match.id}" value="${match.team1}" required> ${match.team1}</label>
                                <label><input type="radio" name="match-${match.id}" value="${match.team2}"> ${match.team2}</label>
                            </div>
                        </div>
                        ${hasPredicted ? `
                            <p class="current-prediction">Current prediction: ${currentPrediction.team}</p>
                            ${drsWasUsed ? '<p>DRS already used.</p>' : `
                                <button class="drs-button" data-match-id="${match.id}">Use DRS</button>
                                <div class="radio-group drs-radio-${match.id}" style="display: none;">
                                    <label><input type="radio" name="drs-match-${match.id}" value="${match.team1}" required> ${match.team1}</label>
                                    <label><input type="radio" name="drs-match-${match.id}" value="${match.team2}"> ${match.team2}</label>
                                </div>
                            `}
                        ` : ''}
                    `}
                </div>
            `;
        }).join('');

        // Reattach DRS listeners
        document.querySelectorAll('.drs-button').forEach(btn => {
            btn.removeEventListener('click', handleDrsClick);
            btn.addEventListener('click', handleDrsClick);
        });

        function handleDrsClick() {
            const matchId = this.dataset.matchId;
            console.log(`DRS clicked for match: ${matchId}`);
            this.style.display = 'none';
            document.querySelector(`.drs-radio-${matchId}`).style.display = 'flex';
        }

        clearInterval(window.timerInterval);
        window.timerInterval = setInterval(updateTimers, 1000);
    } catch (error) {
        console.error('Display predict error:', error);
        document.getElementById('predictError').textContent = 'Failed to load predictions.';
    }
}

        // Display predictions tab with pie chart
       // Display predictions tab with pie chart
let predictionsPieChartInstance = null;
function displayPredictions() {
    const list = document.getElementById('predictionsList');
    // Get current date in user's timezone
    const now = new Date();
    const today = now.toLocaleDateString('en-CA'); // Formats as YYYY-MM-DD (e.g., 2025-04-14)
    
    // Filter predictions for matches scheduled today
    const gameDayPredictions = predictions.filter(p => {
        const match = iplSchedule.find(m => m.id === p.match_id);
        return match && match.date === today;
    });

    list.innerHTML = gameDayPredictions.length > 0 ? `
        <table>
            <thead><tr><th>Date</th><th>User</th><th>Match</th><th>Team</th></tr></thead>
            <tbody>
                ${gameDayPredictions.map(p => {
                    const user = users.find(u => u.id === p.user_id);
                    const match = iplSchedule.find(m => m.id === p.match_id);
                    return user && match ? `
                        <tr>
                            <td>${p.date}</td>
                            <td>${user.name}</td>
                            <td>${match.team1} vs ${match.team2}</td>
                            <td>${p.team}</td>
                        </tr>
                    ` : '';
                }).join('')}
            </tbody>
        </table>
    ` : '<p>No predictions available for today.</p>';

    // Update pie chart for today's predictions
    if (predictionsPieChartInstance) predictionsPieChartInstance.destroy();
    const ctx = document.getElementById('predictionsPieChart').getContext('2d');
    const teamCounts = {};
    const teamUsers = {};
    gameDayPredictions.forEach(p => {
        teamCounts[p.team] = (teamCounts[p.team] || 0) + 1;
        const user = users.find(u => u.id === p.user_id);
        if (user) {
            teamUsers[p.team] = teamUsers[p.team] || [];
            teamUsers[p.team].push(user.name);
        }
    });

    const labels = Object.keys(teamCounts);
    const data = Object.values(teamCounts);
    const colors = [
        '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
        '#FF9F40', '#C9CBCF', '#7BC225', '#F7A4B0', '#5AD3D1'
    ].slice(0, labels.length);

    predictionsPieChartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: colors
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top'
                },
                title: {
                    display: true,
                    text: 'Today\'s Predictions by Team'
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const team = context.label;
                            const count = context.raw;
                            const usersList = teamUsers[team] || [];
                            return `${team}: ${count} (${usersList.join(', ')})`;
                        }
                    }
                }
            }
        }
    });
}

        // Display leaderboard
        let userBarChartInstance = null;
        let userPieChartInstances = [];
        function displayLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            const stats = users.map(user => {
                const userPredictions = predictions.filter(p => p.user_id === user.id);
                const wins = userPredictions.filter(p => {
                    const result = results.find(r => 
                        r.match_id === p.match_id && r.winner === p.team
                    );
                    return !!result;
                }).length;
                const total = userPredictions.length;
                const winPercent = total > 0 ? ((wins / total) * 100).toFixed(2) : '0.00';
                return { 
                    name: user.name, 
                    total: parseInt(total), 
                    wins: parseInt(wins), 
                    winPercent: parseFloat(winPercent)
                };
            });

            stats.sort((a, b) => {
                if (b.wins !== a.wins) return b.wins - a.wins;
                return b.winPercent - a.winPercent;
            });

            let lastWins = null;
            let lastWinPercent = null;
            let currentRank = 0;
            const rankedStats = stats.map((stat, index) => {
                if (stat.wins !== lastWins || stat.winPercent !== lastWinPercent) {
                    currentRank = index + 1;
                }
                lastWins = stat.wins;
                lastWinPercent = stat.winPercent;
                return { ...stat, rank: currentRank };
            });

            leaderboardList.innerHTML = rankedStats.length > 0 ? `
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>User</th>
                            <th>Total Predictions</th>
                            <th>Total Wins</th>
                            <th>Win%</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${rankedStats.map(s => `
                            <tr>
                                <td>${s.rank}</td>
                                <td>${s.name}</td>
                                <td>${s.total}</td>
                                <td>${s.wins}</td>
                                <td>${s.winPercent}%</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            ` : '<p>No leaderboard data available.</p>';

            if (userBarChartInstance) userBarChartInstance.destroy();
            const barCtx = document.getElementById('userBarChart').getContext('2d');
            userBarChartInstance = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: stats.map(s => s.name),
                    datasets: [
                        {
                            label: 'Total Predictions',
                            data: stats.map(s => parseInt(s.total)),
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                        },
                        {
                            label: 'Total Wins',
                            data: stats.map(s => parseInt(s.wins)),
                            backgroundColor: 'rgba(75, 192, 192, 0.5)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Count'
                            },
                            ticks: {
                                stepSize: 1,
                                precision: 0
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Users'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'User Predictions and Wins'
                        }
                    }
                }
            });

            const pieContainer = document.getElementById('userPieCharts');
            pieContainer.innerHTML = '';
            userPieChartInstances.forEach(instance => instance.destroy());
            userPieChartInstances = [];

            stats.forEach(stat => {
                const div = document.createElement('div');
                div.className = 'pie-chart-item';
                div.innerHTML = `<h4>${stat.name}</h4><canvas id="pie-${stat.name.replace(/\s/g, '-')}" style="max-height: 150px;"></canvas>`;
                pieContainer.appendChild(div);

                const ctx = document.getElementById(`pie-${stat.name.replace(/\s/g, '-')}`).getContext('2d');
                const pieChart = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: stat.total > 0 ? ['Wins', 'Losses'] : ['No Data'],
                        datasets: [{
                            data: stat.total > 0 ? [parseInt(stat.wins), parseInt(stat.total - stat.wins)] : [1],
                            backgroundColor: stat.total > 0 ? ['#36A2EB', '#FF6384'] : ['#C9CBCF'],
                            borderColor: stat.total > 0 ? ['#36A2EB', '#FF6384'] : ['#C9CBCF'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top'
                            },
                            title: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        if (stat.total === 0) return 'No Predictions';
                                        const label = context.label;
                                        const value = context.raw;
                                        return `${label}: ${value}`;
                                    }
                                }
                            }
                        }
                    }
                });
                userPieChartInstances.push(pieChart);
            });
        }

        // Admin user form
   document.getElementById('adminUserForm').addEventListener('submit', async e => {
    e.preventDefault();
    const userName = document.getElementById('adminNewUserName')?.value.trim() || '';
    const token = document.getElementById('adminUserToken')?.value.trim().toUpperCase() || '';
    const isAdmin = document.getElementById('isAdmin')?.checked || false;
    const userError = document.getElementById('adminUserError');
    const userSuccess = document.getElementById('adminUserSuccess');
    const form = e.target;
    const userId = form.dataset.id;

    if (!userError || !userSuccess) {
        console.error('Admin user form elements not found');
        return;
    }

    userError.textContent = '';
    userSuccess.textContent = '';

    if (!userName) {
        userError.textContent = 'User name is required.';
        return;
    }
    if (!token) {
        userError.textContent = 'Token is required.';
        return;
    }
    if (!/^[A-Z0-9]{6}$/.test(token)) {
        userError.textContent = 'Token must be 6 alphanumeric characters.';
        return;
    }

    try {
        const { data: existingUsers, error: checkError } = await supabase.from('users').select('id, name, token');
        if (checkError) throw new Error(`Error checking user: ${checkError.message}`);

        const nameTaken = existingUsers.some(u => u.name === userName && (!userId || u.id !== userId));
        const tokenTaken = existingUsers.some(u => u.token === token && (!userId || u.id !== userId));
        if (nameTaken) {
            userError.textContent = 'User name already exists.';
            return;
        }
        if (tokenTaken) {
            userError.textContent = 'Token already in use.';
            return;
        }

        if (userId) {
            const updatedUser = { name: userName, is_admin: isAdmin, token };
            const { error: updateError } = await supabase.from('users').update(updatedUser).eq('id', userId);
            if (updateError) throw new Error(`Failed to update user: ${updateError.message}`);
            users = users.map(u => u.id === userId ? { ...u, name: userName, is_admin: isAdmin, token } : u);
            userSuccess.textContent = `Updated ${userName}${isAdmin ? ' as admin' : ''}!`;
        } else {
            const newUser = { id: generateId(), name: userName, is_admin: isAdmin, token };
            const { data, error: insertError } = await supabase.from('users').insert([newUser]).select();
            if (insertError) throw new Error(`Failed to add user: ${insertError.message}`);
            users.push(data[0]);
            userSuccess.textContent = `Added ${userName}${isAdmin ? ' as admin' : ''}!`;
        }

        form.reset();
        delete form.dataset.id;
        document.getElementById('userFormTitle').textContent = 'Add User';
        document.getElementById('adminUserForm').querySelector('button').textContent = 'Add User';
        document.getElementById('adminUserToken').value = ''; // Clear token explicitly
        displayAdminUsers();
        displayLeaderboard();
        populateUserDropdowns();
    } catch (error) {
        console.error('Error saving user:', error);
        userError.textContent = error.message || 'Failed to save user.';
    }
});

        // CSV import
        document.getElementById('matchCsv').addEventListener('change', handleCsvImport);

        // Manual match form
        document.getElementById('matchForm').addEventListener('submit', async e => {
            e.preventDefault();
            const date = document.getElementById('matchDateAdmin').value;
            const time = document.getElementById('matchTimeAdmin').value;
            const team1 = document.getElementById('matchTeam1').value;
            const team2 = document.getElementById('matchTeam2').value;
            const venue = document.getElementById('matchVenue').value.trim();
            const error = document.getElementById('matchError');
            const success = document.getElementById('matchSuccess');

            console.log('Manual match form submitted:', { date, time, team1, team2, venue });

            if (!date || !time || !team1 || !team2 || !venue) {
                error.textContent = 'All fields required.';
                success.textContent = '';
                return;
            }
            if (team1 === team2) {
                error.textContent = 'Teams must be different.';
                success.textContent = '';
                return;
            }
            if (iplSchedule.some(m => m.date === date && m.team1 === team1 && m.team2 === team2)) {
                error.textContent = 'Match already exists.';
                success.textContent = '';
                return;
            }

            const istDateTime = new Date(`${date}T${time}:00+05:30`);
            istDateTime.setMinutes(istDateTime.getMinutes() - 30);
            const deadline = istDateTime.toISOString();

            const newMatch = { id: generateId(), date, team1, team2, time, deadline, venue };
            iplSchedule.push(newMatch);
            await supabase.from('ipl_schedule').insert([newMatch]);
            error.textContent = '';
            success.textContent = 'Match added!';
            e.target.reset();
            displayAdminSchedule();
            displayPredict();
            displayAdminResults();
        });

        // Result form
        document.getElementById('resultForm').addEventListener('submit', async e => {
            e.preventDefault();
            const form = e.target;
            const matchId = document.getElementById('matchSelect').value;
            const winner = document.querySelector('input[name="winner"]:checked')?.value;
            const error = document.getElementById('resultError');

            console.log('Result form submitted:', { matchId, winner });

            if (!matchId) {
                error.textContent = 'Please select a match.';
                return;
            }
            if (!winner) {
                error.textContent = 'Please select a winner.';
                return;
            }

            const match = iplSchedule.find(m => m.id === matchId);
            if (!match) {
                error.textContent = 'Invalid match selected.';
                return;
            }
            if (![match.team1, match.team2].includes(winner)) {
                error.textContent = 'Winner must be Team 1 or Team 2.';
                return;
            }

            if (form.dataset.id) {
                results = results.map(r => r.id === form.dataset.id ? { id: r.id, match_id: matchId, date: match.date, team1: match.team1, team2: match.team2, winner } : r);
                await supabase.from('results').update({ match_id: matchId, date: match.date, team1: match.team1, team2: match.team2, winner }).eq('id', form.dataset.id);
            } else {
                const newResult = { id: generateId(), match_id: matchId, date: match.date, team1: match.team1, team2: match.team2, winner };
                results.push(newResult);
                await supabase.from('results').insert([newResult]);
            }

            error.textContent = '';
            form.reset();
            delete form.dataset.id;
            document.getElementById('resultDate').value = '';
            document.getElementById('team1').value = '';
            document.getElementById('team2').value = '';
            document.getElementById('winnerRadio').innerHTML = '';
            displayAdminResults();
            displayLeaderboard();
        });

        // Predict form submission
      document.getElementById('submitPredictions').addEventListener('click', async () => {
    try {
        const userId = document.getElementById('predictUserId')?.value || '';
        const token = document.getElementById('predictToken')?.value.trim().toUpperCase() || '';
        const error = document.getElementById('predictError');
        const success = document.getElementById('predictSuccess');
        const today = new Date().toLocaleDateString('en-CA');
        const todayMatches = iplSchedule.filter(m => m.date === today);

        if (!error || !success) throw new Error('Predict form elements not found');

        error.textContent = '';
        success.textContent = '';

        if (!userId || !token) {
            error.textContent = 'Please select a user and enter a token.';
            return;
        }

        const user = users.find(u => u.id === userId && u.token === token);
        if (!user) {
            error.textContent = 'Invalid token for selected user.';
            return;
        }

        const newPredictions = [];
        for (const match of todayMatches) {
            const prediction = document.querySelector(`input[name="match-${match.id}"]:checked`);
            if (prediction) {
                const hasPredicted = predictions.some(p => p.user_id === userId && p.match_id === match.id);
                const deadline = match.deadline ? new Date(match.deadline).getTime() : null;
                if (deadline && new Date().getTime() >= deadline) {
                    error.textContent = `Prediction deadline passed for ${match.team1} vs ${match.team2}.`;
                    return;
                }
                if (!hasPredicted) {
                    newPredictions.push({
                        id: generateId(),
                        user_id: userId,
                        match_id: match.id,
                        team: prediction.value,
                        date: today
                    });
                }
            }

            const drsPrediction = document.querySelector(`input[name="drs-match-${match.id}"]:checked`);
            if (drsPrediction) {
                const hasPredicted = predictions.some(p => p.user_id === userId && p.match_id === match.id);
                const drsWasUsed = drsUsed.some(d => d.user_id === userId && d.match_id === match.id);
                if (!hasPredicted) {
                    error.textContent = `No prediction exists for ${match.team1} vs ${match.team2} to use DRS.`;
                    return;
                }
                if (drsWasUsed) {
                    error.textContent = `DRS already used for ${match.team1} vs ${match.team2}.`;
                    return;
                }
                if (deadline && new Date().getTime() >= deadline) {
                    error.textContent = `Prediction deadline passed for ${match.team1} vs ${match.team2}.`;
                    return;
                }
                predictions = predictions.filter(p => !(p.user_id === userId && p.match_id === match.id));
                newPredictions.push({
                    id: generateId(),
                    user_id: userId,
                    match_id: match.id,
                    team: drsPrediction.value,
                    date: today
                });
                drsUsed.push({ id: generateId(), user_id: userId, match_id: match.id });
            }
        }

        if (newPredictions.length === 0) {
            error.textContent = 'No new predictions or DRS changes made.';
            return;
        }

        predictions.push(...newPredictions);
        await Promise.all([
            supabase.from('predictions').upsert(newPredictions, { onConflict: ['user_id', 'match_id'] }),
            supabase.from('drs_used').upsert(drsUsed, { onConflict: ['user_id', 'match_id'] })
        ]);
        success.textContent = 'Predictions submitted successfully!';
        displayPredict();
        displayPredictions();
        displayLeaderboard();
    } catch (err) {
        console.error('Prediction error:', err);
        document.getElementById('predictError').textContent = 'Failed to submit predictions.';
    }
});

        // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
    console.log('App initialized');
    initializeTabs();
    await fetchData();
    populateUserDropdowns(); // Always populate on load
    displayPredict();
    displayPredictions();
    displayLeaderboard();
    if (localStorage.getItem('adminLoggedIn') === 'true') {
        switchTab('admin');
    }
});

        // PWA setup
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js').catch(err => console.error('Service Worker error:', err));
        }


        // -----for edit schedule functionality
        // Edit match form submission
document.getElementById('editMatchForm').addEventListener('submit', async e => {
    e.preventDefault();
    const matchId = document.getElementById('editMatchId').value;
    const date = document.getElementById('editMatchDate').value;
    const time = document.getElementById('editMatchTime').value;
    const team1 = document.getElementById('editMatchTeam1').value;
    const team2 = document.getElementById('editMatchTeam2').value;
    const venue = document.getElementById('editMatchVenue').value.trim();
    const error = document.getElementById('editMatchError');
    const success = document.getElementById('editMatchSuccess');

    if (!date || !time || !team1 || !team2 || !venue) {
        error.textContent = 'All fields are required.';
        success.textContent = '';
        return;
    }
    if (team1 === team2) {
        error.textContent = 'Teams must be different.';
        success.textContent = '';
        return;
    }
    if (!validTeams.includes(team1) || !validTeams.includes(team2)) {
        error.textContent = 'Invalid team selected.';
        success.textContent = '';
        return;
    }
    if (!['15:30', '19:30'].includes(time)) {
        error.textContent = 'Invalid time selected.';
        success.textContent = '';
        return;
    }
    const existingMatch = iplSchedule.find(m => m.date === date && m.team1 === team1 && m.team2 === team2 && m.id !== matchId);
    if (existingMatch) {
        error.textContent = 'Match already exists on this date with these teams.';
        success.textContent = '';
        return;
    }

    const istDateTime = new Date(`${date}T${time}:00+05:30`);
    istDateTime.setMinutes(istDateTime.getMinutes() - 30);
    const deadline = istDateTime.toISOString();

    const updatedMatch = { id: matchId, date, team1, team2, time, deadline, venue };

    try {
        const { error: updateError } = await supabase.from('ipl_schedule').update(updatedMatch).eq('id', matchId);
        if (updateError) throw updateError;
        iplSchedule = iplSchedule.map(m => m.id === matchId ? updatedMatch : m);
        success.textContent = 'Match updated successfully!';
        error.textContent = '';
        document.getElementById('editMatchModal').style.display = 'none';
        displayAdminSchedule();
        displayPredict();
        displayAdminResults();
    } catch (err) {
        error.textContent = 'Failed to update match.';
        success.textContent = '';
        console.error('Update match error:', err);
    }
});

// Close modal
document.querySelector('#editMatchModal .close').addEventListener('click', () => {
    document.getElementById('editMatchModal').style.display = 'none';
    document.getElementById('editMatchError').textContent = '';
    document.getElementById('editMatchSuccess').textContent = '';
});

document.getElementById('cancelEditMatch').addEventListener('click', () => {
    document.getElementById('editMatchModal').style.display = 'none';
    document.getElementById('editMatchError').textContent = '';
    document.getElementById('editMatchSuccess').textContent = '';
});
    </script>

    <!-- Edit match modal -->
<div id="editMatchModal" class="modal">
    <div class="modal-content">
        <span class="close">×</span>
        <h3>Edit Match</h3>
        <form id="editMatchForm">
            <input type="hidden" id="editMatchId">
            <label for="editMatchDate">Match Date:</label>
            <input type="date" id="editMatchDate" required>
            <label for="editMatchTime">Match Time (IST):</label>
            <select id="editMatchTime" required>
                <option value="">Select time</option>
                <option value="15:30">3:30 PM IST</option>
                <option value="19:30">7:30 PM IST</option>
            </select>
            <label for="editMatchTeam1">Team 1:</label>
            <select id="editMatchTeam1" required>
                <option value="">Select Team 1</option>
                <option value="CSK">CSK</option>
                <option value="MI">MI</option>
                <option value="RCB">RCB</option>
                <option value="KKR">KKR</option>
                <option value="SRH">SRH</option>
                <option value="RR">RR</option>
                <option value="GT">GT</option>
                <option value="DC">DC</option>
                <option value="LSG">LSG</option>
                <option value="PBKS">PBKS</option>
            </select>
            <label for="editMatchTeam2">Team 2:</label>
            <select id="editMatchTeam2" required>
                <option value="">Select Team 2</option>
                <option value="CSK">CSK</option>
                <option value="MI">MI</option>
                <option value="RCB">RCB</option>
                <option value="KKR">KKR</option>
                <option value="SRH">SRH</option>
                <option value="RR">RR</option>
                <option value="GT">GT</option>
                <option value="DC">DC</option>
                <option value="LSG">LSG</option>
                <option value="PBKS">PBKS</option>
            </select>
            <label for="editMatchVenue">Venue:</label>
            <input type="text" id="editMatchVenue" placeholder="Enter venue" required>
            <div id="editMatchError" class="error"></div>
            <div id="editMatchSuccess" class="success"></div>
            <button type="submit">Save Changes</button>
            <button type="button" id="cancelEditMatch">Cancel</button>
        </form>
    </div>
</div>
</body>
</html>
